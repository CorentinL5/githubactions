name: Démonstration complète des variables

on:
  workflow_dispatch:
    inputs:
      couleur:
        description: "Couleur initiale"
        required: true
        default: "jaune"

# 1️⃣ Variables globales du workflow
env:
  MA_VARIABLE_PRENOM: "Alice"
  MA_VARIABLE_NOM: "Bob"
  MA_VARIABLE_MULTILIGNE: |
    Bonjour
    à tous
    !

jobs:
  demo:
    runs-on: ubuntu-latest

    # 2️⃣ Variables au niveau du job
    env:
      COULEUR: "jaune"

    steps:
      # 3️⃣ Utilisation simple des variables
      - name: Afficher les variables globales
        run: |
          echo "Prénom : $MA_VARIABLE_PRENOM"
          echo "Nom : $MA_VARIABLE_NOM"
          echo "Message multilignes :"
          echo "$MA_VARIABLE_MULTILIGNE"

      # 4️⃣ Utilisation via syntaxe GitHub Expression
      - name: Utilisation avec ${{ env.VARIABLE }}
        run: echo "Bonjour ${{ env.MA_VARIABLE_PRENOM }}"

      # 5️⃣ Variable dynamique (modification en cours de workflow)
      - name: Modifier dynamiquement une variable
        run: |
          echo "COULEUR=vert" >> $GITHUB_ENV
          echo "Couleur modifiée dans ce step"

      - name: Vérifier la variable dynamique
        run: echo "Couleur actuelle : $COULEUR"

      # 6️⃣ Variable de sortie (step output)
      - name: Définir une variable de sortie
        id: monStep
        run: |
          echo "NOMVARIABLE=hello" >> $GITHUB_OUTPUT

      - name: Utiliser la variable de sortie
        run: echo "Valeur de sortie : ${{ steps.monStep.outputs.NOMVARIABLE }}"

      # 7️⃣ Variables d’environnement prédéfinies GitHub
      - name: Variables GitHub prédéfinies
        run: |
          echo "Repository : $GITHUB_REPOSITORY"
          echo "Utilisateur : $GITHUB_ACTOR"
          echo "Commit SHA : $GITHUB_SHA"
